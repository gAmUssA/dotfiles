# tmux configuration
# Fixed version addressing configuration issues

# ===============
# Basic Settings
# ===============

# Set prefix to Ctrl-Space
unbind C-b
unbind C-Space 
set -g prefix C-Space
bind C-Space send-prefix

# Performance and behavior settings
set -g history-limit 50000
set -s escape-time 0  # Fast escape (consistent setting)
set -g assume-paste-time 0

# Colors and display
set -g default-terminal "tmux-256color"

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Don't rename windows automatically
set-option -g allow-rename off

# Enable mouse control
set -g mouse on

# ===============
# Key Bindings
# ===============

# Session management
bind-key N new-session

# Reload config file
bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."

# Pane management
unbind x
bind x resize-pane -Z  # Zoom/maximize pane

# Split windows with intuitive keys
bind | split-window -h -c "#{pane_current_path}"
bind _ split-window -c "#{pane_current_path}"

# Resize panes
bind C-l resize-pane -R 10
bind C-j resize-pane -D 10
bind C-h resize-pane -L 10
# Note: Removed C-k binding to avoid conflicts
bind C-u resize-pane -U 10  # Changed from C-k to C-u

bind * resize-pane -x 80

# Swap panes
bind ) swap-pane -D
bind ( swap-pane -U

# Synchronize panes
bind = setw synchronize-panes

# Layout management
bind-key @ select-layout even-horizontal
bind-key ! select-layout even-vertical
bind l select-layout -n
bind L select-layout -p

# Pane navigation with Alt-arrow (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Cycle through panes with double prefix
unbind ^A
bind ^A select-pane -t :.+

# Clear pane (safer binding that doesn't conflict)
bind -n C-M-k send-keys -R \; clear-history

# Pane title management
bind-key t command-prompt -p "Rename pane:" "select-pane -T '%%'"
bind-key T if -F '#{?#{==:#{pane-border-status},off},0,1}' 'set pane-border-status off' 'set pane-border-status top'

# ===============
# Plugin Configuration
# ===============

# TPM Plugin list
set -g @tpm_plugins '          \
   tmux-plugins/tpm             \
   tmux-plugins/tmux-sensible   \
   tmux-plugins/tmux-resurrect  \
   tmux-plugins/tmux-continuum  \
   dracula/tmux                 \
'

# Plugin settings
set -g @continuum-restore 'on'

# Dracula theme settings
set -g @dracula-show-powerline true
set -g @dracula-show-flags true
set -g @dracula-plugins "cpu-usage ram-usage time"
set -g @dracula-left-icon-padding 0
set -g @dracula-military-time true

# ===============
# macOS Compatibility
# ===============

# Modern macOS doesn't need reattach-to-user-namespace
# Only set if the utility exists (for older systems)
if-shell 'command -v reattach-to-user-namespace >/dev/null 2>&1' \
    'set-option -g default-command "reattach-to-user-namespace -l $SHELL"' \
    'set-option -g default-command "$SHELL"'

# ===============
# Plugin Manager Initialization
# ===============

# Initialize TPM (keep at bottom) - with error handling
if-shell 'test -f ~/.tmux/plugins/tpm/tpm' \
    'run ~/.tmux/plugins/tpm/tpm' \
    'display-message "TPM not installed. Run: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm"'